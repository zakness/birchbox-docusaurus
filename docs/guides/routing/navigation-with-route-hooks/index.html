<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Navigation with Route Hooks · Bernard Docs</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;Route hooks are components that make sure the user has access to a view and redirects them somewhere else if they don’t. Let’s look at what happens when route hooks are encountered during a &lt;a href=&quot;/birchbox-docusaurus/docs/guides/routing/the-navigation-event&quot;&gt;navigation event&lt;/a&gt;.&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Navigation with Route Hooks · Bernard Docs"/><meta property="og:type" content="website"/><meta property="og:url" content="https://zakness.github.io/birchbox-docusaurus/index.html"/><meta property="og:description" content="&lt;p&gt;Route hooks are components that make sure the user has access to a view and redirects them somewhere else if they don’t. Let’s look at what happens when route hooks are encountered during a &lt;a href=&quot;/birchbox-docusaurus/docs/guides/routing/the-navigation-event&quot;&gt;navigation event&lt;/a&gt;.&lt;/p&gt;
"/><meta property="og:image" content="https://zakness.github.io/birchbox-docusaurus/img/docusaurus.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://zakness.github.io/birchbox-docusaurus/img/docusaurus.png"/><link rel="shortcut icon" href="/birchbox-docusaurus/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/birchbox-docusaurus/css/prism.css"/><link rel="stylesheet" href="/birchbox-docusaurus/css/main.css"/></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/birchbox-docusaurus/"><img class="logo" src="/birchbox-docusaurus/img/docusaurus.svg" alt="Bernard Docs"/><h2 class="headerTitleWithLogo">Bernard Docs</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/birchbox-docusaurus/docs/guides/getting-started" target="_self">Docs</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Guides</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Guides</h3><ul><li class="navListItem"><a class="navItem" href="/birchbox-docusaurus/docs/guides/getting-started">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/birchbox-docusaurus/docs/guides/addresses">Addresses</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Routing</h4><ul><li class="navListItem"><a class="navItem" href="/birchbox-docusaurus/docs/guides/routing/routing-intro">Intro to Routing</a></li><li class="navListItem"><a class="navItem" href="/birchbox-docusaurus/docs/guides/routing/the-navigation-event">The Navigation Event</a></li><li class="navListItem"><a class="navItem" href="/birchbox-docusaurus/docs/guides/routing/basic-navigation-example">Basic Navigation Example</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/birchbox-docusaurus/docs/guides/routing/navigation-with-route-hooks">Navigation with Route Hooks</a></li><li class="navListItem"><a class="navItem" href="/birchbox-docusaurus/docs/guides/routing/writing-a-route-hook">Writing a Route Hook</a></li><li class="navListItem"><a class="navItem" href="/birchbox-docusaurus/docs/guides/routing/router-redux-state">router Redux State</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Components</h3><ul><li class="navListItem"><a class="navItem" href="/birchbox-docusaurus/docs/components/address">Address</a></li><li class="navListItem"><a class="navItem" href="/birchbox-docusaurus/docs/components/address-fields">AddressFields</a></li><li class="navListItem"><a class="navItem" href="/birchbox-docusaurus/docs/components/address-form">AddressForm</a></li><li class="navListItem"><a class="navItem" href="/birchbox-docusaurus/docs/components/address-list">AddressList</a></li><li class="navListItem"><a class="navItem" href="/birchbox-docusaurus/docs/components/address-selector">AddressSelector</a></li><li class="navListItem"><a class="navItem" href="/birchbox-docusaurus/docs/components/address-usage-checkboxes">AddressUsageCheckboxes</a></li><li class="navListItem"><a class="navItem" href="/birchbox-docusaurus/docs/components/form">Form2Beta Form</a></li><li class="navListItem"><a class="navItem" href="/birchbox-docusaurus/docs/components/page-view-dispatcher">PageViewDispatcher</a></li><li class="navListItem"><a class="navItem" href="/birchbox-docusaurus/docs/components/redirect">Redirect</a></li><li class="navListItem"><a class="navItem" href="/birchbox-docusaurus/docs/components/view-route">ViewRoute</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Enhancers</h3><ul><li class="navListItem"><a class="navItem" href="/birchbox-docusaurus/docs/enhancers/component-loader">ComponentLoader</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Utils</h3><ul><li class="navListItem"><a class="navItem" href="/birchbox-docusaurus/docs/utils/get-vertical-routes">getVerticalRoutes</a></li><li class="navListItem"><a class="navItem" href="/birchbox-docusaurus/docs/utils/history">history</a></li><li class="navListItem"><a class="navItem" href="/birchbox-docusaurus/docs/utils/validators">Validators</a></li><li class="navListItem"><a class="navItem" href="/birchbox-docusaurus/docs/utils/verify-address">verifyAddress</a></li></ul></div></div></section></div><script>
            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Navigation with Route Hooks</h1></header><article><div><span><p>Route hooks are components that make sure the user has access to a view and redirects them somewhere else if they don’t. Let’s look at what happens when route hooks are encountered during a <a href="/birchbox-docusaurus/docs/guides/routing/the-navigation-event">navigation event</a>.</p>
<p>We’ll start with the app from our <a href="/birchbox-docusaurus/docs/guides/routing/basic-navigation-example">basic navigation example</a> and add a new constraint: The user must be logged in to see <code>&lt;ViewB&gt;</code>. If they aren’t logged in, they will be redirected to <code>&lt;LoginView&gt;</code> to log in.</p>
<p>To accomplish this, we’ll wrap <code>&lt;ViewB&gt;</code>’s <code>&lt;PageViewDispatcher&gt;</code> with a <a href="https://github.com/birchbox/bernard_black/blob/develop/src/components/RouteHooks/RequireAuth.js"><code>&lt;RequireAuth&gt;</code></a> route hook:</p>
<pre><code class="hljs css language-diff">  import { Switch } from 'react-router-dom'
<span class="hljs-addition">+ import DisallowAuth from 'components/RouteHooks/DisallowAuth'</span>
  import PageViewDispatcher from 'components/Routing/PageViewDispatcher'
<span class="hljs-addition">+ import RequireAuth from 'components/RouteHooks/RequireAuth'</span>
  import Router from 'components/Routing/Router'
  import ViewRoute from 'components/Routing/ViewRoute'

<span class="hljs-addition">+ const LoginView = ComponentLoader({ loader: () =&gt; import('views/LoginView') })</span>
  const ViewA = ComponentLoader({ loader: () =&gt; import('views/ViewA') })
  const ViewB = ComponentLoader({ loader: () =&gt; import('views/ViewB') })

  ReactDOM.render(
    &lt;Router&gt;
      &lt;Switch&gt;
        &lt;ViewRoute path='/a' pageType='a'&gt;
          &lt;PageViewDispatcher&gt;
            &lt;ViewA /&gt;
          &lt;/PageViewDispatcher&gt;
        &lt;/ViewRoute&gt;
        &lt;ViewRoute path='/b' pageType='b'&gt;
<span class="hljs-addition">+         &lt;RequireAuth&gt;</span>
            &lt;PageViewDispatcher&gt;
              &lt;ViewB /&gt;
            &lt;/PageViewDispatcher&gt;
<span class="hljs-addition">+         &lt;/RequireAuth&gt;</span>
        &lt;/ViewRoute&gt;
<span class="hljs-addition">+       &lt;ViewRoute path='/sign-in' pageType='signIn'&gt;</span>
<span class="hljs-addition">+         &lt;DisallowAuth&gt;</span>
<span class="hljs-addition">+           &lt;PageViewDispatcher&gt;</span>
<span class="hljs-addition">+             &lt;LoginView /&gt;</span>
<span class="hljs-addition">+           &lt;/PageViewDispatcher&gt;</span>
<span class="hljs-addition">+         &lt;/DisallowAuth&gt;</span>
<span class="hljs-addition">+       &lt;/ViewRoute&gt;</span>
      &lt;/Switch&gt;
    &lt;/Router&gt;,
    document.getElementById('root')
  )
</code></pre>
<p>As in the basic example, let’s start with the user logged out on <code>/a</code>. When they click a link to <code>/b</code>, <code>LOCATION_CHANGE</code> and <code>VIEW_ROUTE_MATCH</code> are dispatched as before. However, this time <code>&lt;ViewRoute path='/b'&gt;</code>’s direct child is <code>&lt;RequireAuth&gt;</code>, which renders different things depending on the user’s auth state. Since the user is not logged in, it renders a <code>&lt;Redirect to='/sign-in'&gt;</code> instead of its <code>children</code> prop.</p>
<p>This is the crux of a route hook’s design: Perform some checks (and/or optionally download some data) and only render <code>children</code> when everything is in order. This way we separate the routing logic from the view render logic, allowing view components to be simpler. In other words, views can assume that if they are mounted, they are allowed to be viewed.</p>
<p>Back to our scenario. The user has just been redirected to <code>/sign-in</code>, which means <code>LOCATION_CHANGE</code> has been dispatched and <code>&lt;ViewRoute path='/sign-in'&gt;</code> has mounted and dispatched <code>VIEW_ROUTE_MATCH</code>. Now <a href="https://github.com/birchbox/bernard_black/blob/develop/src/components/RouteHooks/DisallowAuth.js"><code>&lt;DisallowAuth&gt;</code></a> is mounted, which just performs a pass-through render of its <code>children</code> since the user is not logged in. <code>PAGE_VIEW</code> is dispatched and <code>&lt;LoginView&gt;</code> is mounted.</p>
<p>Finally, the user logs in and then (one presumes) is redirected to <code>/b</code>, which triggers a navigation event that successfully passes through <code>&lt;RequireAuth&gt;</code> and lands on <code>&lt;ViewB&gt;</code>.</p>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 2019-1-6 by Zak Linder</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/birchbox-docusaurus/docs/guides/routing/basic-navigation-example"><span class="arrow-prev">← </span><span>Basic Navigation Example</span></a><a class="docs-next button" href="/birchbox-docusaurus/docs/guides/routing/writing-a-route-hook"><span>Writing a Route Hook</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"></nav></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'my-api-key',
                indexName: 'my-index-name',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>